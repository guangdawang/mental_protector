# 心灵方舟 (MindDark)

青少年心理健康守护应用，通过实时内容检测和情绪分析，在危机时刻提供及时支持。

## 功能特性

### 第一版本核心功能

1. **实时危机检测**
   - 13个关键词检测（自杀、不想活了、死了算了等）
   - 输入模式分析（反复删除、极速输入、深夜使用）
   - 自动情绪状态评估

2. **安全岛界面**
   - 深蓝色呼吸引导界面
   - 6秒呼吸循环（吸气2s + 屏息1s + 呼气3s）
   - 星光动态背景
   - 心跳声（可选）

3. **一键求助系统**
   - 8个内置危机热线电话
   - 一键拨号功能
   - 完全离线可用

4. **紧急联系人**
   - 最多3个紧急联系人
   - 10秒倒计时自动发送求助短信
   - 可随时取消

5. **状态管理**
   - 实时情绪状态显示
   - 危机历史记录
   - 用户设置持久化

6. **设置页面** ✅ 新增
   - 紧急联系功能开关（3个月过期机制）
   - 月度提醒设置
   - 振动反馈开关
   - 音频播放控制（音量调节）
   - 紧急联系人管理（添加/删除）
   - 数据备份/恢复
   - 清除所有数据

7. **本地数据存储** ✅ 新增
   - 使用Hive进行高性能本地存储
   - 紧急联系人持久化
   - 情绪记录历史（最多100条）
   - 用户设置持久化

8. **数据加密与备份** ✅ 新增
   - AES-256加密
   - 导出为.heart文件
   - 支持自定义密码
   - 数据完整性验证（SHA-256）
   - 支持分享备份文件

9. **引导页面** ✨ 新增
   - 首次启动自动显示
   - 6页功能介绍
   - 可跳过
   - 精美动画效果

10. **情绪记录历史** ✨ 新增
   - 自动记录情绪变化
   - 按日期分组显示
   - 趋势指示器（上升/下降/平稳）
   - 最多保留100条记录

## 技术栈

- **框架**: Flutter 3.19.0+
- **语言**: Dart 3.3.0+
- **状态管理**: Riverpod
- **本地存储**: Hive
- **加密**: encrypt (AES-256)
- **音频**: audioplayers
- **振动**: vibration

## 快速开始

### 1. 环境要求

- Flutter SDK 3.19.0+
- Dart SDK 3.3.0+
- Android Studio 或 VS Code
- Android 9.0+ 设备或模拟器

### 2. 安装依赖

```bash
flutter pub get
```

### 3. 运行应用

```bash
flutter run
```

## 项目结构

```
lib/
├── main.dart                    # 应用入口（初始化Hive）
├── app.dart                     # 主应用Widget
│
├── core/                        # 核心层
│   ├── detection/               # 检测模块
│   │   ├── keyword_detector.dart      # 关键词检测
│   │   ├── input_pattern.dart          # 输入模式分析
│   │   └── crisis_detector.dart        # 危机检测器
│   │
│   ├── state/                   # 状态管理
│   │   ├── emotion_state.dart         # 情绪状态
│   │   ├── user_state.dart            # 用户状态
│   │   └── providers.dart              # 全局Providers
│   │
│   ├── encryption/              # 加密模块 ✅ 新增
│   │   └── encryption_service.dart    # 加密服务
│   │
│   └── constants.dart           # 常量定义
│
├── features/                    # 功能模块
│   ├── safe_harbor/             # 安全岛
│   │   ├── screens/
│   │   │   └── safe_harbor_screen.dart  # 安全岛界面
│   │   ├── components/
│   │   │   └── breathing_circle.dart   # 呼吸圆圈
│   │   └── services/
│   │       ├── hotline_service.dart    # 热线服务
│   │       └── contact_service.dart    # 紧急联系人服务
│   │
│   ├── settings/                # 设置页面 ✅ 新增
│   │   └── screens/
│   │       └── settings_screen.dart     # 设置界面
│   │
│   └── backup/                  # 数据备份 ✅ 新增
│       └── backup_service.dart          # 备份服务
│
├── data/                        # 数据层
│   ├── models/
│   │   └── contact_model.dart   # 联系人模型
│   │
│   └── local_storage/           # 本地存储 ✅ 新增
│       ├── hive_adapters.dart          # Hive适配器
│       └── storage_service.dart        # 存储服务
│
└── ui/                          # UI组件
    └── themes/
        ├── app_theme.dart       # 主题配置
        └── colors.dart          # 颜色常量
```

## 使用说明

### 首次使用

1. 首次打开应用会自动显示引导页面
2. 浏览6页功能介绍，了解应用功能
3. 点击"开始使用"或"跳过"进入主页

### 测试危机检测

1. 点击首页的"测试输入检测"按钮
2. 在对话框中输入文字，包含关键词如"自杀"、"不想活了"等
3. 系统会自动检测并进入安全岛

### 查看情绪记录

1. 点击首页右上角的"历史记录"图标（时钟图标）
2. 查看按日期分组的情绪变化
3. 观察趋势指示器了解情绪走向

### 手动进入安全岛

点击首页的"手动进入安全岛"按钮，可直接进入安全岛界面。

### 拨打热线电话

在安全岛中：
1. 点击"一键拨打热线"
2. 展开列表选择要拨打的热线
3. 点击"拨打"按钮

### 联系紧急联系人

1. 点击右上角设置图标进入设置页面
2. 在"紧急联系人"部分添加联系人
3. 启用"紧急联系功能"
4. 在安全岛中点击"联系紧急联系人"
5. 等待10秒倒计时或取消

### 数据备份

1. 进入设置页面
2. 点击"备份数据"
3. 等待备份完成
4. 可选择分享备份文件

### 数据恢复

1. 进入设置页面
2. 点击"恢复数据"
3. 选择.heart备份文件
4. 等待恢复完成

## 权限说明

应用需要以下权限：

- **CALL_PHONE**: 拨打热线电话
- **VIBRATE**: 呼吸同步振动
- **SEND_SMS**: 发送紧急求助短信
- **READ_PHONE_STATE**: 优化拨号体验
- **POST_NOTIFICATIONS**: 显示提醒通知

## 隐私保护

- 所有数据仅存储在本地设备
- 不上传任何用户数据到服务器
- 数据备份文件（.heart）使用AES-256加密

## 开发计划

### 第一阶段（已完成）
- [x] 基础框架搭建
- [x] 关键词检测引擎
- [x] 安全岛UI界面
- [x] 一键求助系统
- [x] 紧急联系人功能

### 第二阶段（已完成）✅
- [x] 设置页面
- [x] 本地数据存储（Hive）
- [x] 数据加密与备份
- [x] 情绪记录历史
- [ ] 图表可视化

### 第三阶段（未来）
- [ ] iOS适配
- [ ] Web版支持
- [ ] 资源更新API
- [ ] 崩溃报告收集
- [ ] 国际化支持

## 注意事项

1. **紧急联系功能默认关闭**，用户需要主动在设置中开启
2. **所有短信发送都有10秒倒计时**，可随时取消
3. **热线电话列表内置在应用中**，无需网络即可使用
4. **紧急联系人设置3个月后过期**，需重新确认

## 常见问题

**Q: 为什么没有立即检测到关键词？**
A: 检测在文本提交时进行，实时检测会在输入时触发。

**Q: 如何添加紧急联系人？**
A: 进入设置页面 → 紧急联系人 → 点击"添加紧急联系人"。

**Q: 数据备份文件在哪里？**
A: 备份文件保存在应用目录，可在设置中通过"备份数据"查看和分享。

**Q: 心跳声如何关闭？**
A: 进入设置页面 → 音频 → 关闭"音频播放"开关。

**Q: 备份文件如何安全传输？**
A: 备份文件使用AES-256加密，可以安全地通过邮件、云盘或USB传输。

## 许可证

本项目仅供学习和教育使用。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 项目地址: [GitHub Repository]
- 邮箱: [Email]

---

**记住：你不是一个人在战斗。**
**如果你需要帮助，请拨打热线电话。**
